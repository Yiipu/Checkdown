{"name":"checkdown_db","desc":"","tables":[{"name":"mdx_files","type":"BASE TABLE","comment":"","columns":[{"name":"id","type":"int","nullable":false,"default":null,"comment":"","extra_def":"auto_increment"},{"name":"file","type":"mediumtext","nullable":false,"default":null,"comment":""},{"name":"popularity","type":"int","nullable":true,"default":"0","comment":""},{"name":"description","type":"varchar(255)","nullable":true,"default":null,"comment":""},{"name":"created_at","type":"timestamp","nullable":true,"default":"CURRENT_TIMESTAMP","extra_def":"DEFAULT_GENERATED","comment":""},{"name":"updated_at","type":"timestamp","nullable":true,"default":"CURRENT_TIMESTAMP","extra_def":"DEFAULT_GENERATED on update CURRENT_TIMESTAMP","comment":""},{"name":"file_name","type":"varchar(255)","nullable":false,"default":null,"comment":""}],"indexes":[{"name":"file_name","def":"KEY file_name (file_name, description) USING FULLTEXT","table":"mdx_files","columns":["file_name","description"],"comment":""},{"name":"file_name_2","def":"KEY file_name_2 (file_name) USING FULLTEXT","table":"mdx_files","columns":["file_name"],"comment":""},{"name":"PRIMARY","def":"PRIMARY KEY (id) USING BTREE","table":"mdx_files","columns":["id"],"comment":""}],"constraints":[{"name":"PRIMARY","type":"PRIMARY KEY","def":"PRIMARY KEY (id)","table":"mdx_files","referenced_table":null,"columns":["id"],"referenced_columns":null,"comment":""}],"triggers":[],"def":"CREATE TABLE `mdx_files` (\n  `id` int NOT NULL AUTO_INCREMENT,\n  `file` mediumtext COLLATE utf8mb4_general_ci NOT NULL,\n  `popularity` int DEFAULT '0',\n  `description` varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,\n  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,\n  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  `file_name` varchar(255) COLLATE utf8mb4_general_ci NOT NULL,\n  PRIMARY KEY (`id`),\n  FULLTEXT KEY `file_name` (`file_name`,`description`),\n  FULLTEXT KEY `file_name_2` (`file_name`)\n) ENGINE=InnoDB AUTO_INCREMENT=[Redacted by tbls] DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci"},{"name":"progresses","type":"BASE TABLE","comment":"","columns":[{"name":"workspace_id","type":"int","nullable":false,"default":null,"comment":""},{"name":"task_id","type":"int","nullable":false,"default":null,"comment":""},{"name":"is_done","type":"tinyint(1)","nullable":true,"default":"0","comment":""},{"name":"updated_by_user","type":"varchar(255)","nullable":true,"default":null,"comment":""},{"name":"updated_at","type":"timestamp","nullable":true,"default":"CURRENT_TIMESTAMP","extra_def":"DEFAULT_GENERATED on update CURRENT_TIMESTAMP","comment":""}],"indexes":[{"name":"updated_by_user","def":"KEY updated_by_user (updated_by_user) USING BTREE","table":"progresses","columns":["updated_by_user"],"comment":""},{"name":"PRIMARY","def":"PRIMARY KEY (workspace_id, task_id) USING BTREE","table":"progresses","columns":["workspace_id","task_id"],"comment":""}],"constraints":[{"name":"PRIMARY","type":"PRIMARY KEY","def":"PRIMARY KEY (workspace_id, task_id)","table":"progresses","referenced_table":null,"columns":["workspace_id","task_id"],"referenced_columns":null,"comment":""},{"name":"progresses_ibfk_1","type":"FOREIGN KEY","def":"FOREIGN KEY (updated_by_user) REFERENCES users (sub)","table":"progresses","referenced_table":"users","columns":["updated_by_user"],"referenced_columns":["sub"],"comment":""}],"triggers":[{"name":"check_user_access","def":"CREATE TRIGGER check_user_access BEFORE INSERT ON progresses\nFOR EACH ROW\nBEGIN\n    DECLARE user_access INT;\n    SELECT COUNT(*) INTO user_access\n    FROM user_workspaces\n    WHERE user_sub = NEW.updated_by_user AND workspace_id = NEW.workspace_id;\n    IF user_access = 0 THEN\n        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'User does not have access to this workspace';\n    END IF;\nEND","comment":""},{"name":"check_user_access_update","def":"CREATE TRIGGER check_user_access_update BEFORE UPDATE ON progresses\nFOR EACH ROW\nBEGIN\n    DECLARE user_access INT;\n    SELECT COUNT(*) INTO user_access\n    FROM user_workspaces\n    WHERE user_sub = NEW.updated_by_user AND workspace_id = NEW.workspace_id;\n    IF user_access = 0 THEN\n        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'User does not have access to this workspace';\n    END IF;\nEND","comment":""}],"def":"CREATE TABLE `progresses` (\n  `workspace_id` int NOT NULL,\n  `task_id` int NOT NULL,\n  `is_done` tinyint(1) DEFAULT '0',\n  `updated_by_user` varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,\n  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  PRIMARY KEY (`workspace_id`,`task_id`),\n  KEY `updated_by_user` (`updated_by_user`),\n  CONSTRAINT `progresses_ibfk_1` FOREIGN KEY (`updated_by_user`) REFERENCES `users` (`sub`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci"},{"name":"u_f_view","type":"VIEW","comment":"VIEW","columns":[{"name":"u_id","type":"varchar(255)","nullable":false,"default":null,"comment":""},{"name":"f","type":"mediumtext","nullable":false,"default":null,"comment":""},{"name":"f_name","type":"varchar(255)","nullable":false,"default":null,"comment":""},{"name":"description","type":"varchar(255)","nullable":true,"default":null,"comment":""},{"name":"f_id","type":"int","nullable":false,"default":"0","comment":""},{"name":"is_public","type":"tinyint(1)","nullable":true,"default":"0","comment":""}],"indexes":[],"constraints":[],"triggers":[],"def":"CREATE VIEW u_f_view AS (select `u`.`user_sub` AS `u_id`,`m`.`file` AS `f`,`m`.`file_name` AS `f_name`,`m`.`description` AS `description`,`m`.`id` AS `f_id`,`u`.`is_public` AS `is_public` from (`checkdown_db`.`user_files` `u` join `checkdown_db`.`mdx_files` `m` on((`u`.`file_id` = `m`.`id`))))","referenced_tables":["user_files","mdx_files"]},{"name":"user_files","type":"BASE TABLE","comment":"","columns":[{"name":"user_sub","type":"varchar(255)","nullable":false,"default":null,"comment":""},{"name":"file_id","type":"int","nullable":false,"default":null,"comment":""},{"name":"is_public","type":"tinyint(1)","nullable":true,"default":"0","comment":""}],"indexes":[{"name":"file_id","def":"KEY file_id (file_id) USING BTREE","table":"user_files","columns":["file_id"],"comment":""},{"name":"PRIMARY","def":"PRIMARY KEY (user_sub, file_id) USING BTREE","table":"user_files","columns":["user_sub","file_id"],"comment":""}],"constraints":[{"name":"PRIMARY","type":"PRIMARY KEY","def":"PRIMARY KEY (user_sub, file_id)","table":"user_files","referenced_table":null,"columns":["user_sub","file_id"],"referenced_columns":null,"comment":""},{"name":"user_files_ibfk_1","type":"FOREIGN KEY","def":"FOREIGN KEY (user_sub) REFERENCES users (sub)","table":"user_files","referenced_table":"users","columns":["user_sub"],"referenced_columns":["sub"],"comment":""},{"name":"user_files_ibfk_2","type":"FOREIGN KEY","def":"FOREIGN KEY (file_id) REFERENCES mdx_files (id)","table":"user_files","referenced_table":"mdx_files","columns":["file_id"],"referenced_columns":["id"],"comment":""}],"triggers":[],"def":"CREATE TABLE `user_files` (\n  `user_sub` varchar(255) COLLATE utf8mb4_general_ci NOT NULL,\n  `file_id` int NOT NULL,\n  `is_public` tinyint(1) DEFAULT '0',\n  PRIMARY KEY (`user_sub`,`file_id`),\n  KEY `file_id` (`file_id`),\n  CONSTRAINT `user_files_ibfk_1` FOREIGN KEY (`user_sub`) REFERENCES `users` (`sub`),\n  CONSTRAINT `user_files_ibfk_2` FOREIGN KEY (`file_id`) REFERENCES `mdx_files` (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci"},{"name":"user_workspaces","type":"BASE TABLE","comment":"","columns":[{"name":"user_sub","type":"varchar(255)","nullable":false,"default":null,"comment":""},{"name":"workspace_id","type":"int","nullable":false,"default":null,"comment":""},{"name":"privilege","type":"enum('manager','partner')","nullable":true,"default":"partner","comment":""}],"indexes":[{"name":"workspace_id","def":"KEY workspace_id (workspace_id) USING BTREE","table":"user_workspaces","columns":["workspace_id"],"comment":""},{"name":"PRIMARY","def":"PRIMARY KEY (user_sub, workspace_id) USING BTREE","table":"user_workspaces","columns":["user_sub","workspace_id"],"comment":""}],"constraints":[{"name":"PRIMARY","type":"PRIMARY KEY","def":"PRIMARY KEY (user_sub, workspace_id)","table":"user_workspaces","referenced_table":null,"columns":["user_sub","workspace_id"],"referenced_columns":null,"comment":""},{"name":"user_workspaces_ibfk_1","type":"FOREIGN KEY","def":"FOREIGN KEY (user_sub) REFERENCES users (sub)","table":"user_workspaces","referenced_table":"users","columns":["user_sub"],"referenced_columns":["sub"],"comment":""},{"name":"user_workspaces_ibfk_2","type":"FOREIGN KEY","def":"FOREIGN KEY (workspace_id) REFERENCES workspaces (id)","table":"user_workspaces","referenced_table":"workspaces","columns":["workspace_id"],"referenced_columns":["id"],"comment":""}],"triggers":[],"def":"CREATE TABLE `user_workspaces` (\n  `user_sub` varchar(255) COLLATE utf8mb4_general_ci NOT NULL,\n  `workspace_id` int NOT NULL,\n  `privilege` enum('manager','partner') COLLATE utf8mb4_general_ci DEFAULT 'partner',\n  PRIMARY KEY (`user_sub`,`workspace_id`),\n  KEY `workspace_id` (`workspace_id`),\n  CONSTRAINT `user_workspaces_ibfk_1` FOREIGN KEY (`user_sub`) REFERENCES `users` (`sub`),\n  CONSTRAINT `user_workspaces_ibfk_2` FOREIGN KEY (`workspace_id`) REFERENCES `workspaces` (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci"},{"name":"users","type":"BASE TABLE","comment":"","columns":[{"name":"id","type":"int","nullable":false,"default":null,"comment":"","extra_def":"auto_increment"},{"name":"sub","type":"varchar(255)","nullable":false,"default":null,"comment":""},{"name":"password","type":"varchar(255)","nullable":true,"default":null,"comment":""},{"name":"nickname","type":"varchar(255)","nullable":true,"default":null,"comment":""},{"name":"name","type":"varchar(255)","nullable":true,"default":null,"comment":""},{"name":"picture","type":"varchar(255)","nullable":true,"default":null,"comment":""},{"name":"email","type":"varchar(255)","nullable":true,"default":null,"comment":""},{"name":"email_verified","type":"tinyint(1)","nullable":true,"default":"0","comment":""}],"indexes":[{"name":"PRIMARY","def":"PRIMARY KEY (id) USING BTREE","table":"users","columns":["id"],"comment":""},{"name":"sub","def":"UNIQUE KEY sub (sub) USING BTREE","table":"users","columns":["sub"],"comment":""}],"constraints":[{"name":"PRIMARY","type":"PRIMARY KEY","def":"PRIMARY KEY (id)","table":"users","referenced_table":null,"columns":["id"],"referenced_columns":null,"comment":""},{"name":"sub","type":"UNIQUE","def":"UNIQUE KEY sub (sub)","table":"users","referenced_table":null,"columns":["sub"],"referenced_columns":null,"comment":""}],"triggers":[],"def":"CREATE TABLE `users` (\n  `id` int NOT NULL AUTO_INCREMENT,\n  `sub` varchar(255) COLLATE utf8mb4_general_ci NOT NULL,\n  `password` varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,\n  `nickname` varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,\n  `name` varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,\n  `picture` varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,\n  `email` varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,\n  `email_verified` tinyint(1) DEFAULT '0',\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `sub` (`sub`)\n) ENGINE=InnoDB AUTO_INCREMENT=[Redacted by tbls] DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci"},{"name":"w_uw_view","type":"VIEW","comment":"VIEW","columns":[{"name":"id","type":"int","nullable":false,"default":"0","comment":""},{"name":"created","type":"timestamp","nullable":true,"default":"CURRENT_TIMESTAMP","extra_def":"DEFAULT_GENERATED","comment":""},{"name":"u_id","type":"varchar(255)","nullable":false,"default":null,"comment":""},{"name":"privilege","type":"enum('manager','partner')","nullable":true,"default":"partner","comment":""},{"name":"f_id","type":"int","nullable":false,"default":null,"comment":""},{"name":"f_name","type":"varchar(255)","nullable":false,"default":null,"comment":""}],"indexes":[],"constraints":[],"triggers":[],"def":"CREATE VIEW w_uw_view AS (select `w`.`id` AS `id`,`w`.`created_at` AS `created`,`uw`.`user_sub` AS `u_id`,`uw`.`privilege` AS `privilege`,`w`.`file_id` AS `f_id`,`m`.`file_name` AS `f_name` from ((`checkdown_db`.`workspaces` `w` join `checkdown_db`.`user_workspaces` `uw` on((`w`.`id` = `uw`.`workspace_id`))) join `checkdown_db`.`mdx_files` `m` on((`w`.`file_id` = `m`.`id`))))","referenced_tables":["workspaces","user_workspaces","mdx_files"]},{"name":"workspaces","type":"BASE TABLE","comment":"","columns":[{"name":"id","type":"int","nullable":false,"default":null,"comment":"","extra_def":"auto_increment"},{"name":"created_at","type":"timestamp","nullable":true,"default":"CURRENT_TIMESTAMP","extra_def":"DEFAULT_GENERATED","comment":""},{"name":"file_id","type":"int","nullable":false,"default":null,"comment":""},{"name":"invite_code","type":"varchar(20)","nullable":true,"default":null,"comment":""},{"name":"code_expire_at","type":"timestamp","nullable":true,"default":null,"comment":""}],"indexes":[{"name":"file_id","def":"KEY file_id (file_id) USING BTREE","table":"workspaces","columns":["file_id"],"comment":""},{"name":"PRIMARY","def":"PRIMARY KEY (id) USING BTREE","table":"workspaces","columns":["id"],"comment":""},{"name":"invite_code","def":"UNIQUE KEY invite_code (invite_code) USING BTREE","table":"workspaces","columns":["invite_code"],"comment":""}],"constraints":[{"name":"invite_code","type":"UNIQUE","def":"UNIQUE KEY invite_code (invite_code)","table":"workspaces","referenced_table":null,"columns":["invite_code"],"referenced_columns":null,"comment":""},{"name":"PRIMARY","type":"PRIMARY KEY","def":"PRIMARY KEY (id)","table":"workspaces","referenced_table":null,"columns":["id"],"referenced_columns":null,"comment":""},{"name":"workspaces_ibfk_1","type":"FOREIGN KEY","def":"FOREIGN KEY (file_id) REFERENCES mdx_files (id)","table":"workspaces","referenced_table":"mdx_files","columns":["file_id"],"referenced_columns":["id"],"comment":""}],"triggers":[],"def":"CREATE TABLE `workspaces` (\n  `id` int NOT NULL AUTO_INCREMENT,\n  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,\n  `file_id` int NOT NULL,\n  `invite_code` varchar(20) COLLATE utf8mb4_general_ci DEFAULT NULL,\n  `code_expire_at` timestamp NULL DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `invite_code` (`invite_code`),\n  KEY `file_id` (`file_id`),\n  CONSTRAINT `workspaces_ibfk_1` FOREIGN KEY (`file_id`) REFERENCES `mdx_files` (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=[Redacted by tbls] DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci"}],"relations":[{"table":"progresses","columns":["updated_by_user"],"cardinality":"Zero or more","parent_table":"users","parent_columns":["sub"],"parent_cardinality":"Zero or one","def":"FOREIGN KEY (updated_by_user) REFERENCES users (sub)","virtual":false},{"table":"user_files","columns":["user_sub"],"cardinality":"Zero or more","parent_table":"users","parent_columns":["sub"],"parent_cardinality":"Exactly one","def":"FOREIGN KEY (user_sub) REFERENCES users (sub)","virtual":false},{"table":"user_files","columns":["file_id"],"cardinality":"Zero or more","parent_table":"mdx_files","parent_columns":["id"],"parent_cardinality":"Exactly one","def":"FOREIGN KEY (file_id) REFERENCES mdx_files (id)","virtual":false},{"table":"user_workspaces","columns":["user_sub"],"cardinality":"Zero or more","parent_table":"users","parent_columns":["sub"],"parent_cardinality":"Exactly one","def":"FOREIGN KEY (user_sub) REFERENCES users (sub)","virtual":false},{"table":"user_workspaces","columns":["workspace_id"],"cardinality":"Zero or more","parent_table":"workspaces","parent_columns":["id"],"parent_cardinality":"Exactly one","def":"FOREIGN KEY (workspace_id) REFERENCES workspaces (id)","virtual":false},{"table":"workspaces","columns":["file_id"],"cardinality":"Zero or more","parent_table":"mdx_files","parent_columns":["id"],"parent_cardinality":"Exactly one","def":"FOREIGN KEY (file_id) REFERENCES mdx_files (id)","virtual":false}],"functions":[],"driver":{"name":"mysql","database_version":"8.2.0","meta":{"dict":{"Functions":"Stored procedures and functions"}}}}
